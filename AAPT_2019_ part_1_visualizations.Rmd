---
title: "Stats WS"
author: "Jayson Nissen"
date: "5/7/2018"
output: pdf_document
---
Notes on things to cover.
How markdown works.
Loading data.
Using the help menu.
Adding and loading packages.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(msm) #this has the rtnorm function for generating the data.

#library(tidyr)
library(psych) #contains describe function 3.3 MB
#library(knitr) #634 kb
library(effsize) #33 kb
#library(cowplot)
library(knitr)
library(tidyr)
library(dplyr)
library(ggplot2)

#setwd("~/Documents/GitHub/Stats-WS-master/Stats_WS") #set the working directory to a folder for this project. It makes life easier.

std.err <- function(x) sqrt(var(x,na.rm=TRUE)/length(na.omit(x)))

#Color blind palletes for making figures
plot_col <- c('#66c2a5', '#fc8d62', '#8da0cb')
cbbpalette <- c('#000000','#E69F00','#56B4E9')

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

Build the datasets
Replace this with uploading the dataset. Make sure we have a nice big dataset that works well

```{r, include=FALSE}
set.seed(45637268)
ci_data <- data.frame(pre= rtnorm(n=1000,mean=30,sd=24,lower=0,upper=100),
                      gain= rtnorm(n=1000,mean=12,sd=35,lower=-10,upper=70))
ci_data$post <- ci_data$pre + ci_data$gain
ci_data$post[ci_data$post>100] <- 100
ci_data$post[ci_data$post<0] <- 0
ci_data$gain <- ci_data$post-ci_data$pre
write.csv(ci_data, file="ci_data_long_statsig_large_eff")
```

Build representations of the data.
Scatter plot
```{r}
plot(ci_data$pre,ci_data$post, main='Pre/Post Scatter Plot', xlab = "Pre", ylab="Post")
abline(0,1)
```
Boxplot
```{r}
boxplot(ci_data[c(1,3)], main='Boxplots of Pretest and Posttest Scores')
```
Histograms
```{r}
hist(ci_data$pre,col = rgb(1,0,0,0.4),xlab = 'Score', ylab='Count', main='Distribution of Pretest Score')
```
```{r}
hist(ci_data$post,col = rgb(0,0,1,0.4),xlab = 'Score', ylab='Count', main='Distribution of Posttest Scores')
```

```{r}
#Note that this is a terrible way to make a histogram. We highly recommend learning ggplot and the tidyverse.
## calculate the histograms - don't plot yet
histpre <- hist(ci_data$pre,plot = FALSE, breaks=10)
histpost <- hist(ci_data$post,plot = FALSE, breaks=10)
## calculate the range of the graph
xlim <- range(histpre$breaks,histpost$breaks)
ylim <- range(0,histpre$counts,
              histpost$counts)
## plot the first graph
plot(histpre,xlim = xlim, ylim = ylim,
     col = rgb(1,0,0,0.4),xlab = 'Score', ylab='Count',
     freq = TRUE, ## relative, not absolute frequency
     main = 'Distribution of Pretest and Posttest Scores')
## plot the second graph on top of this
opar <- par(new = FALSE)
plot(histpost,xlim = xlim, ylim = ylim,
     xaxt = 'n', yaxt = 'n', ## don't add axes
     col = rgb(0,0,1,0.4), add = TRUE,
     freq = TRUE) ## relative, not absolute frequency
## add a legend in the corner
legend('topleft',c('Pre','Post'),
       fill = rgb(1:0,0,0:1,0.4), bty = 'n',
       border = NA)
par(opar)
```
Stop!

Discuss these visualizations with your group and we will have a large group discussion before we move on to making visualization with ggplot.


Now we want to work through this using ggplot.
```{r}
ggplot(data=ci_data, aes(x=pre)) + 
  geom_histogram() +
  theme_minimal()

ggplot(data=ci_data, aes(x=pre)) + 
  geom_histogram(color="red", fill= "green", alpha=0.5) +
  theme_minimal()

ggplot(data=ci_data, aes(x=pre)) + 
  geom_histogram(color="red", fill= "green", alpha=0.5) +
  labs(title = "Histogram of Pretest Scores", y="Count", x= "Test Score (%)")

ggplot(data=ci_data, aes(x=pre)) + 
  geom_histogram(color="red", fill= "green", alpha=0.5) +
  theme(plot.title = element_text(hjust = 0.5))+
  labs(title = "Histogram of Pretest Scores", y="Count", x= "Test Score (%)")

ggplot(data=ci_data, aes(x=pre)) + 
  geom_density(color="red", fill= "green", alpha=0.5) +
  theme(plot.title = element_text(hjust = 0.5))+
  labs(title = "Histogram of Pretest Scores", y="Count", x= "Test Score (%)")

```

Now we want to make comparisons, which requires reformating the data. ggplot works on the premise that all of the data is in a single vector and different vectors have information about the groupings that we will need.

To make side by side histograms in ggplot we need to put all of the test scores into one column and the pre/posttest names into a different column.

```{r}
plot_data <- gather(ci_data[c(1,3)], key="time", value = "score")

ggplot(data=plot_data, aes(x=score, group=time, fill=time) ) + 
  geom_histogram(alpha=0.5, position = "identity") +
  theme(plot.title = element_text(hjust = 0.5))+
  labs(title = "Histogram of Pretest Scores", y="Count", x= "Test Score (%)")
```

Activity! Use the ci_data and/or plot_data to create 
(1) a scatter plot, 
(2) a box plot, and 
(3) a density plot.

```{r}

```
Additional things to do:
Change the colors
Add fit line to the scatter plot
Change the Alpha
Modify the legend
Any other ideas that you have that we should share with everyone.


Extra Activity: Use the plot data with the extra course variable to divide it into two groups and create a faceted density plot with pre and post histograms for both groups (i.e., facet by course)
```{r}
plot_data$course <- sample(x=c("H","T"), prob = c(0.5,0.5))


```


